# Versioning Policy
# OBS Scene Switcher

> NOTE FOR COPILOT:
> このドキュメントは「バージョンごとの実装可能範囲」を定義する。
> バージョン契約を破る実装は禁止。

---

## v0.1.x — UI 基盤

- プラグイン構造
- Dock UI
- 設定保存
- 認証 UI（通信なし）

---

## v0.2.x — OAuth 基盤

- Twitch OAuth 実装
- DPAPI による安全な認証情報保存
- 認証状態 UI

---

## v0.3.x — UX 改善

- 認証状態の可視化
- エラーダイアログ改善
- 初回起動安定化

---

## v0.4.x — EventSub 導入

- WebSocket 接続
- Channel Point 通知受信
- セッション管理

---

## v0.5.x — ルール・復帰処理

- RewardRule 導入
- シーン復帰タイマー
- ルール永続化

---

## v0.6.0 — 状態管理（完了）

- SceneSwitchState 導入
- 競合制御
- revertSeconds = 0 対応

---

## v0.6.1 — 有効 / 無効 トグル（完了）

**実装内容**:
- プラグイン全体の Enabled / Disabled 制御
- UI トグルボタンによる手動有効化（起動時は常に Disabled）
- Enabled = EventSub 接続開始
- Disabled = EventSub 完全停止
- プラグイン無効時は Redemption を無視
- 基本的な状態表示（待機中/切替中/復帰中/抑制中）
- カウントダウンタイマー（復帰までの残り秒数、1秒更新）
- UI 改善（セパレーター、認証状態表示（赤丸・緑丸）、ログアウトボタン）

**設計原則**:
- UI 操作なしでの自動接続は禁止
- pluginEnabled_ と EventSub 接続状態は常に同期

**注記**:
- 状態表示の基本実装を含む（v0.6.2 から前倒し実装）
- v0.6.2 ではシーン名の詳細化のみを実装

---

## v0.6.2 — 状態詳細化

**実装内容**:
- シーン名を含む詳細な状態表示
  - 例: `🔄 切替中: ゲームシーン`
  - 例: `⏱ 復帰中: メインシーンへ`
- 切替先・復帰先のシーン名を UI に表示

**実装制約**:
- ロジック追加は禁止（表示のみ）
- 既存の stateChanged シグナルにシーン名パラメータを追加
- State Machine の変更は禁止

**注記**:
- v0.6.1 で基本的な状態表示（シーン名なし）は実装済み
- 本バージョンでは表示の詳細化のみを実施

---

## v0.6.3 — ルール単位制御

- Rule Enable / Disable
- 無効ルールは完全無視

---

## v0.6.4 — UI 改善（完了）

**実装内容**:
- ルール並び替え（ドラッグ&ドロップ）
- 削除 UX 改善
- 視認性調整

---

## v0.6.5 — 任意シーンマッチング（完了）

**実装内容**:
- ソースシーンに「任意(Any)」オプションを追加
- 「任意(Any)」選択時、現在のシーンに関係なくルールが実行される
- 既存のルール優先順位システムと統合
  - 具体的なシーン指定ルールを「任意」ルールより上に配置することで優先制御可能

**設計原則**:
- ルール評価は上から順に実行（変更なし）
- マッチング条件:
  1. rewardId の一致
  2. enabled フラグの確認
  3. sourceScene のチェック:
     - 空文字列または "Any" → すべてのシーンにマッチ
     - 具体的なシーン名 → 現在のシーンと一致する必要あり

**UI 変更**:
- RuleRow の現在シーンコンボボックスに「任意(Any)」を先頭に追加
- 「任意(Any)」選択時は内部的に "Any" として保存
- 既存ルールの後方互換性維持（空文字列も「任意」として動作）

**技術詳細**:
- `SceneSwitcher::getCurrentSceneName()` を public に変更
- `ObsSceneSwitcher::onRedemptionReceived()` でシーンマッチングを実装
- ログ出力の改善（デバッグ時に現在シーンとマッチング結果を表示）

---

## v0.7.0 — 配布準備

- ログ整理（INFO / DEBUG）
- 初回起動 UX
- README 整備
