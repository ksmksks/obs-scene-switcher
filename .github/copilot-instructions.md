# GitHub Copilot Instructions
# OBS Scene Switcher Plugin

## 0. このファイルについて（必読）

このファイルは、本リポジトリにおける  
**設計上の憲法・実装判断基準・禁止事項**を定義する。

GitHub Copilot は、コード生成・提案・チャット回答において  
必ず本ファイルの内容を最優先で適用すること。

---

## 1. 参照必須ドキュメント

本プロジェクトの詳細仕様は、以下のドキュメントに定義されている。

- `doc/architecture.md`
  - シーン切替の状態管理（State Machine）
  - コンポーネント責務分離
  - 有効 / 無効 制御の考え方

- `doc/versioning.md`
  - バージョン契約
  - マイルストーン
  - 実装可能範囲の判断基準

**コード生成前に必ずこれらを参照し、現在のバージョン範囲を確認すること。**

---

## 2. プロジェクト概要

本プロジェクトは OBS Studio 用プラグインであり、  
Twitch Channel Point Redemption をトリガーとして  
OBS のシーンを **安全かつ予測可能に** 切り替える。

本プラグインが最重要視する価値は以下である：

- 状態駆動（State-driven）設計
- 同時イベント・連続発火に対する完全な競合制御
- UI 操作に基づく明示的な有効 / 無効 制御
- バージョン契約を厳守した段階的実装

---

## 3. 最重要設計原則（厳守）

### 3.1 状態駆動シーン切替

- シーン切替は **必ず State を介して行う**
- 直接的なシーン切替呼び出しは禁止
- 状態遷移は `State` enum により明示的に管理する
  - `Idle` → `Switched` → `Reverting` → `Idle`
  
詳細は `doc/architecture.md` を参照。

---

### 3.2 競合制御

- 同時に複数のシーン切替を実行してはならない
- 切替中に新たなイベントが発生した場合は抑制または無視する
- タイミング依存（sleep / delay）による制御は禁止
- 状態遷移のみを唯一の制御手段とする

---

## 4. UI と接続ポリシー

- プラグインは **常に Disabled 状態で起動する**
- UI で Enabled に切り替えた場合のみ EventSub を接続する
- Enabled = EventSubClient::start()
- Disabled = EventSubClient::stop()（完全停止）

※ UI 操作なしでの自動接続は禁止。
※ OBS の配信／録画イベントによる有効化は、UI 操作と同一フローとして扱う。

---

## 5. バージョン契約

- 本プロジェクトのバージョン契約および実装可能範囲は `doc/versioning.md` に定義されている
- 実装・提案・コード生成前に、必ず現在のバージョン範囲を確認すること
- バージョン契約を破る実装は禁止

---

## 6. v1.0.0 以降の拡張原則（予定）

v1.0.0 正式版リリース後、コア機能が確定します。今後の拡張は以下の原則に従う予定です：

### 6.1 コア仕様の保護

- v1.0.0 で確定したシーン切替ロジックに対する破壊的変更は禁止
- State Machine の基本挙動は維持
- 既存機能は新機能の有効 / 無効に関わらず変わらず動作

### 6.2 拡張レイヤとしての実装

- 新機能は既存機能に影響を与えない形で追加
- オプトイン方式（デフォルトで無効、明示的に有効化）
- Action 抽象化を前提とした設計

### 6.3 後方互換性

- 設定ファイルフォーマットは後方互換性を維持
- 古いバージョンの設定は新バージョンでも動作
- 新しい設定項目は古いバージョンで無視される

**注意**: 現在は v0.9.0 ベータ版です。v1.0.0 正式版で上記原則が適用されます。

---

## 7. 禁止事項

- バージョンを跨いだ先行実装
- UI 操作なしでの Twitch / EventSub 接続
- Disabled 状態でのロジック実行
- 状態チェックを省略したシーン切替
- 推測による実装（不明点は TODO とすること）
- **コード内コメントへのバージョン番号記載**
- **v1.0.0（正式版）以降：コア仕様に対する破壊的変更**

---

## 8. Copilot への明示指示

- 既存設計と責務分離を最優先で尊重すること
- State Machine を中心に実装を考えること
- 判断不能な場合は実装せず TODO を出力すること
- **実装前に必ず `doc/versioning.md` で現在のバージョン範囲を確認すること**
- **コメントにはバージョン番号を含めない（機能の説明のみ）**
- **v1.0.0（正式版）以降：既存機能への影響を必ず評価すること**
- **現在は v0.9.0 ベータ版：フィードバックに基づく改善を優先すること**
